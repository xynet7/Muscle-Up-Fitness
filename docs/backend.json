{
  "entities": {
    "MembershipPlan": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MembershipPlan",
      "type": "object",
      "description": "Represents a gym membership plan.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the membership plan."
        },
        "name": {
          "type": "string",
          "description": "Name of the membership plan (e.g., 'Basic', 'Premium')."
        },
        "durationMonths": {
          "type": "number",
          "description": "Duration of the membership plan in months."
        },
        "price": {
          "type": "number",
          "description": "Price of the membership plan."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the plan's benefits and features."
        }
      },
      "required": [
        "id",
        "name",
        "durationMonths",
        "price",
        "description"
      ]
    },
    "Subscription": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Subscription",
      "type": "object",
      "description": "Represents a user's subscription to a membership plan.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the subscription."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User. (Relationship: User 1:N Subscription)"
        },
        "membershipPlanId": {
          "type": "string",
          "description": "Reference to the MembershipPlan. (Relationship: MembershipPlan 1:N Subscription)"
        },
        "startDate": {
          "type": "string",
          "description": "Start date of the subscription.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "End date of the subscription.",
          "format": "date-time"
        },
        "receiptId": {
          "type": "string",
          "description": "Reference to the Receipt. (Relationship: Receipt 1:1 Subscription)"
        }
      },
      "required": [
        "id",
        "userId",
        "membershipPlanId",
        "startDate",
        "endDate",
        "receiptId"
      ]
    },
    "Receipt": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Receipt",
      "type": "object",
      "description": "Represents a receipt for a membership purchase.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the receipt."
        },
        "transactionDate": {
          "type": "string",
          "description": "Date of the transaction.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "Amount paid for the subscription."
        },
        "paymentMethod": {
          "type": "string",
          "description": "Payment method used for the transaction (e.g., 'Credit Card', 'PayPal')."
        },
        "subscriptionId": {
          "type": "string",
          "description": "Reference to the Subscription. (Relationship: Subscription 1:1 Receipt)"
        }
      },
      "required": [
        "id",
        "transactionDate",
        "amount",
        "paymentMethod",
        "subscriptionId"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the gym website.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "fitnessGoals": {
          "type": "string",
          "description": "Fitness goals of the user."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "fitnessGoals"
      ]
    },
    "Admin": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Admin",
      "type": "object",
      "description": "Represents an administrator of the gym website.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the admin user."
        },
        "username": {
          "type": "string",
          "description": "Username of the admin user."
        },
        "role": {
          "type": "string",
          "description": "Role of the admin user (e.g., 'superadmin', 'manager')."
        }
      },
      "required": [
        "id",
        "username",
        "role"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/membershipPlans/{membershipPlanId}",
        "definition": {
          "entityName": "MembershipPlan",
          "schema": {
            "$ref": "#/backend/entities/MembershipPlan"
          },
          "description": "Stores all membership plans available on the gym website. Anyone should be able to read, only admins can write.",
          "params": [
            {
              "name": "membershipPlanId",
              "description": "The unique identifier of the membership plan."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles.  Accessible by the user and potentially by admins for management.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user. This ID will match the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/subscriptions/{subscriptionId}",
        "definition": {
          "entityName": "Subscription",
          "schema": {
            "$ref": "#/backend/entities/Subscription"
          },
          "description": "Stores a user's subscription information. Accessible only by the user and potentially admins.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, matching the Firebase Auth UID."
            },
            {
              "name": "subscriptionId",
              "description": "The unique identifier of the subscription."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/receipts/{receiptId}",
        "definition": {
          "entityName": "Receipt",
          "schema": {
            "$ref": "#/backend/entities/Receipt"
          },
          "description": "Stores receipts associated with a user's subscription. Accessible only by the user and potentially admins.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, matching the Firebase Auth UID."
            },
            {
              "name": "receiptId",
              "description": "The unique identifier of the receipt."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "Admin",
          "schema": {
            "$ref": "#/backend/entities/Admin"
          },
          "description": "Stores admin roles. The existence of a document at this path indicates admin privileges for the given user ID. Uses Existence over Content strategy.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the admin user, matching the Firebase Auth UID."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure authorization independence, clarity, and scalability for the MuscleUp gym membership application. It leverages path-based ownership for user-specific data and a dedicated collection for global admin roles. This design avoids hierarchical authorization dependencies (`get()` calls in security rules), enabling atomic operations (transactions/batches) and simplifying debugging. The design uses Structural Segregation (Homogeneous Security Posture) by storing all documents in a collection that shares the same security requirements. For example, user subscriptions are stored under their respective user document to enforce ownership. Membership Plans are stored in a top-level collection because they do not have an owner and are visible to all users. This structure enables secure list operations via segregation. Subscriptions and Receipts are stored as subcollections of users to keep ownership and access simple."
  }
}